import{a as B}from"./chunk-B2LUGKIE.js";import{Aa as y,Ba as S,Ha as T,Ia as M,Ja as P,La as H,N as s,Na as F,P as w,Q as D,Qa as L,U as m,Y as d,Za as N,_ as h,aa as o,ba as i,bb as j,da as g,ea as _,ga as A,ha as p,la as b,ma as l,na as u,oa as c,wa as C,xa as U,za as x}from"./chunk-6P7KIDLQ.js";var I=(t,n,e)=>({"text-green-400":t,"text-yellow-400":n,"text-red-400":e}),k=(t,n)=>({"text-green-400":t,"text-red-500":n});function K(t,n){if(t&1&&(o(0,"span",24),l(1," Next expiry: "),o(2,"strong",13),l(3),i()()),t&2){let e=p();d("ngClass",U(2,I,e.nextExpiryDays>14,e.nextExpiryDays>7&&e.nextExpiryDays<=14,e.nextExpiryDays<=7)),s(3),c("",e.nextExpiryDays," days")}}function V(t,n){t&1&&(o(0,"div",25),l(1,"Loading\u2026"),i())}function Y(t,n){if(t&1&&(o(0,"div",26),l(1),i()),t&2){let e=p();s(),u(e.error)}}function q(t,n){if(t&1&&(o(0,"p",35),l(1),i()),t&2){let e=p(2);s(),c("Plan: ",e.primaryUi==null?null:e.primaryUi.plan,"")}}function z(t,n){if(t&1&&(g(0),l(1),_()),t&2){let e=p(3);s(),c(" ",e.formatHms((e.primaryUi==null?null:e.primaryUi.remainingSeconds)||0)," left ")}}function G(t,n){if(t&1&&l(0),t&2){let e,r=p(3);c(" ",(e=r.primaryUi==null?null:r.primaryUi.remainingDays)!==null&&e!==void 0?e:"\u2014"," days left ")}}function J(t,n){if(t&1&&(o(0,"span",36),l(1," \u25CF "),m(2,z,2,1,"ng-container",34)(3,G,1,1,"ng-template",null,2,S),i()),t&2){let e,r=b(4),a=p(2);d("ngClass",U(3,I,((e=a.primaryUi==null?null:a.primaryUi.remainingDays)!==null&&e!==void 0?e:0)>14,((e=a.primaryUi==null?null:a.primaryUi.remainingDays)!==null&&e!==void 0?e:0)<=14&&((e=a.primaryUi==null?null:a.primaryUi.remainingDays)!==null&&e!==void 0?e:0)>7,((e=a.primaryUi==null?null:a.primaryUi.remainingDays)!==null&&e!==void 0?e:0)<=7)),s(2),d("ngIf",(a.primaryUi==null?null:a.primaryUi.isTrial)&&(a.primaryUi==null?null:a.primaryUi.remainingSeconds)!==null)("ngIfElse",r)}}function Q(t,n){if(t&1&&(o(0,"div",45),l(1),x(2,"date"),i()),t&2){let e=p(3);s(),c(" Starts on: ",y(2,1,e.primaryUi==null?null:e.primaryUi.startedAt,"yyyy-MM-dd")," ")}}function W(t,n){t&1&&(o(0,"a",46),l(1," Extend "),i())}function X(t,n){if(t&1&&(g(0),o(1,"div",37)(2,"div",38)(3,"span",39),l(4,"Status"),i(),o(5,"span",40),l(6),i()(),o(7,"div",38)(8,"span",39),l(9,"Expires"),i(),o(10,"span",41),l(11),x(12,"date"),i()(),o(13,"div",38)(14,"span",39),l(15,"Purchased"),i(),o(16,"span",41),l(17),x(18,"date"),i()(),m(19,Q,3,4,"div",42),i(),o(20,"div",43),m(21,W,2,0,"a",44),i(),_()),t&2){let e=p(2);s(5),d("ngClass",C(12,k,e.primaryUi==null?null:e.primaryUi.active,!(e.primaryUi!=null&&e.primaryUi.active))),s(),c(" ",e.primaryUi!=null&&e.primaryUi.active?"Active":"Expired"," "),s(5),u(e.primaryUi!=null&&e.primaryUi.expiresAt?y(12,6,e.primaryUi==null?null:e.primaryUi.expiresAt,"yyyy-MM-dd"):"\u2014"),s(6),u(e.primaryUi!=null&&e.primaryUi.createdAt?y(18,9,e.primaryUi==null?null:e.primaryUi.createdAt,"yyyy-MM-dd"):"\u2014"),s(2),d("ngIf",e.isFuture(e.primaryUi==null?null:e.primaryUi.startedAt)),s(2),d("ngIf",!(e.primaryUi!=null&&e.primaryUi.isTrial))}}function Z(t,n){t&1&&(o(0,"div",47),l(1," No active Premium Plan subscription. "),i(),o(2,"div",48)(3,"a",49),l(4," Start now "),i()())}function ee(t,n){if(t&1&&(o(0,"p",35),l(1),i()),t&2){let e=p(2);s(),c("Plan: ",e.advancedUi==null?null:e.advancedUi.plan,"")}}function te(t,n){if(t&1&&(g(0),l(1),_()),t&2){let e=p(3);s(),c(" ",e.formatHms((e.advancedUi==null?null:e.advancedUi.remainingSeconds)||0)," left ")}}function ne(t,n){if(t&1&&l(0),t&2){let e,r=p(3);c(" ",(e=r.advancedUi==null?null:r.advancedUi.remainingDays)!==null&&e!==void 0?e:"\u2014"," days left ")}}function ie(t,n){if(t&1&&(o(0,"span",36),l(1," \u25CF "),m(2,te,2,1,"ng-container",34)(3,ne,1,1,"ng-template",null,3,S),i()),t&2){let e,r=b(4),a=p(2);d("ngClass",U(3,I,((e=a.advancedUi==null?null:a.advancedUi.remainingDays)!==null&&e!==void 0?e:0)>14,((e=a.advancedUi==null?null:a.advancedUi.remainingDays)!==null&&e!==void 0?e:0)<=14&&((e=a.advancedUi==null?null:a.advancedUi.remainingDays)!==null&&e!==void 0?e:0)>7,((e=a.advancedUi==null?null:a.advancedUi.remainingDays)!==null&&e!==void 0?e:0)<=7)),s(2),d("ngIf",(a.advancedUi==null?null:a.advancedUi.isTrial)&&(a.advancedUi==null?null:a.advancedUi.remainingSeconds)!==null)("ngIfElse",r)}}function re(t,n){if(t&1&&(o(0,"div",45),l(1),x(2,"date"),i()),t&2){let e=p(3);s(),c(" Starts on: ",y(2,1,e.advancedUi==null?null:e.advancedUi.startedAt,"yyyy-MM-dd")," ")}}function ae(t,n){if(t&1&&(g(0),o(1,"div",37)(2,"div",38)(3,"span",39),l(4,"Status"),i(),o(5,"span",40),l(6),i()(),o(7,"div",38)(8,"span",39),l(9,"Expires"),i(),o(10,"span",41),l(11),x(12,"date"),i()(),o(13,"div",38)(14,"span",39),l(15,"Purchased"),i(),o(16,"span",41),l(17),x(18,"date"),i()(),m(19,re,3,4,"div",42),i(),o(20,"div",43)(21,"a",46),l(22," Extend "),i()(),_()),t&2){let e=p(2);s(5),d("ngClass",C(11,k,e.advancedUi==null?null:e.advancedUi.active,!(e.advancedUi!=null&&e.advancedUi.active))),s(),c(" ",e.advancedUi!=null&&e.advancedUi.active?"Active":"Expired"," "),s(5),u(e.advancedUi!=null&&e.advancedUi.expiresAt?y(12,5,e.advancedUi==null?null:e.advancedUi.expiresAt,"yyyy-MM-dd"):"\u2014"),s(6),u(e.advancedUi!=null&&e.advancedUi.createdAt?y(18,8,e.advancedUi==null?null:e.advancedUi.createdAt,"yyyy-MM-dd"):"\u2014"),s(2),d("ngIf",e.isFuture(e.advancedUi==null?null:e.advancedUi.startedAt))}}function le(t,n){t&1&&(o(0,"div",47),l(1," No active Advanced Plan subscription. "),i(),o(2,"div",48)(3,"a",49),l(4," Add Advanced Plan "),i()())}function oe(t,n){if(t&1&&(o(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"h3",31),l(5,"Premium Plan"),i(),m(6,q,2,1,"p",32),i(),m(7,J,5,7,"span",33),i(),m(8,X,22,15,"ng-container",34)(9,Z,5,0,"ng-template",null,0,S),i(),o(11,"div",28)(12,"div",29)(13,"div",30)(14,"h3",31),l(15,"Advanced Plan"),i(),m(16,ee,2,1,"p",32),i(),m(17,ie,5,7,"span",33),i(),m(18,ae,23,14,"ng-container",34)(19,le,5,0,"ng-template",null,1,S),i()()),t&2){let e=b(10),r=b(20),a=p();s(),h("opacity-80",!a.primaryUi),s(5),d("ngIf",a.primaryUi==null?null:a.primaryUi.plan),s(),d("ngIf",a.primaryUi),s(),d("ngIf",a.primaryUi)("ngIfElse",e),s(3),h("opacity-80",!a.advancedUi),s(5),d("ngIf",a.advancedUi==null?null:a.advancedUi.plan),s(),d("ngIf",a.advancedUi),s(),d("ngIf",a.advancedUi)("ngIfElse",r)}}function se(t,n){t&1&&(o(0,"div",50),l(1," No previous subscriptions found. "),i())}function de(t,n){if(t&1&&(o(0,"li",53)(1,"span",54),l(2),i(),o(3,"span",55),l(4),x(5,"date"),i()()),t&2){let e=n.$implicit,r=p(2);s(2),u(r.formatModel(e.model)),s(2),u(y(5,2,e.createdAt,"yyyy-MM-dd"))}}function pe(t,n){if(t&1&&(o(0,"div",48)(1,"ul",51),m(2,de,6,5,"li",52),i()()),t&2){let e=p();s(2),d("ngForOf",e.sortedHistory)}}var R=class t{constructor(n){this.http=n}String(n){throw new Error("Method not implemented.")}primarySubscription=null;advancedSubscription=null;history=[];primaryUi=null;advancedUi=null;sortedHistory=[];showHistory=!1;countdownTimer;subsCount=0;nextExpiryDays=null;loading=!0;error=null;ngOnInit(){this.http.get(`${B.apiBaseUrl}/users/me`,{withCredentials:!0}).subscribe({next:n=>{this.primarySubscription=n?.subscriptionPrimary??null,this.advancedSubscription=n?.subscriptionAdvanced??null,this.history=n?.subscriptionHistory??[],this.primaryUi=this.toUi("Premium Plan",this.primarySubscription),this.advancedUi=this.toUi("Advanced Plan",this.advancedSubscription),this.sortedHistory=[...this.history].sort((e,r)=>new Date(r.startedAt).getTime()-new Date(e.startedAt).getTime()),this.updateSummary(),this.loading=!1,this.error=null},error:n=>{console.error("Fehler beim Laden",n),this.loading=!1,this.error="Failed to load subscriptions."}}),this.startCountdown()}ngOnDestroy(){clearInterval(this.countdownTimer)}startCountdown(){clearInterval(this.countdownTimer),this.countdownTimer=setInterval(()=>{let n=e=>{if(!(!e||!e.isTrial||!e.remainingSeconds)&&(e.remainingSeconds=Math.max(0,e.remainingSeconds-1),e.expiresAt)){let r=Date.parse(e.expiresAt)-Date.now();e.remainingDays=Math.max(0,Math.ceil(r/864e5))}};n(this.primaryUi),n(this.advancedUi)},1e3)}formatHms(n){if(!n||n<=0)return"00:00:00";let e=Math.floor(n),r=Math.floor(e/3600),a=Math.floor(e%3600/60),E=e%60,v=f=>f<10?"0"+f:""+f;return`${v(r)}:${v(a)}:${v(E)}`}toUi(n,e){if(!e)return null;let r=this.formatModel(String(e.model??"")),a=e.expiresAt??null,E=e.createdAt??null,v=e.startedAt??null,f=typeof e.remainingDays=="number"?e.remainingDays:null,O=e.costInEuro??e.constInEuro??null,$=typeof f=="number"?f>0:a?new Date(a)>new Date:!1;return{label:n,plan:r,expiresAt:a,createdAt:E,startedAt:v,remainingDays:f,priceEuro:O,active:$,isTrial:!!e.isTrial,remainingSeconds:typeof e.remainingSeconds=="number"?e.remainingSeconds:null}}updateSummary(){let n=[this.primaryUi,this.advancedUi].filter(Boolean);this.subsCount=n.filter(r=>r.active).length;let e=n.filter(r=>r.active&&typeof r.remainingDays=="number").map(r=>r.remainingDays).sort((r,a)=>r-a)[0];this.nextExpiryDays=Number.isFinite(e)?e:null}goToPricing(){window.location.href="/pricing"}toggleHistory(){this.showHistory=!this.showHistory}formatModel(n){return n?n.replace("_"," ").toLowerCase().replace(/\b\w/g,e=>e.toUpperCase()):""}isFuture(n){return n?new Date(n)>new Date:!1}static \u0275fac=function(e){return new(e||t)(w(L))};static \u0275cmp=D({type:t,selectors:[["app-subscription"]],decls:26,vars:8,consts:[["noPrimary",""],["noAuto",""],["primaryDaysLeft",""],["advancedDaysLeft",""],[1,"min-h-screen","bg-[#141C22]","text-white","px-4","py-12"],[1,"text-center","mb-10"],[1,"text-3xl","font-bold"],[1,"max-w-6xl","mx-auto"],[1,"bg-[#10181f]","border","border-[#1d2a32]","rounded-xl","p-4","sm:p-5"],[1,"flex","flex-col","sm:flex-row","gap-3","sm:items-center"],[1,"text-base","sm:text-lg","font-semibold","text-white"],[1,"sm:ml-auto","flex","flex-wrap","items-center","gap-2","sm:gap-3"],[1,"inline-flex","items-center","rounded-full","border","border-[#1d2a32]","bg-[#0a1117]","px-3","py-1","text-xs","sm:text-sm","text-white"],[1,"ml-1"],["class","inline-flex items-center rounded-full border border-[#1d2a32] bg-[#0a1117] px-3 py-1 text-xs sm:text-sm",3,"ngClass",4,"ngIf"],["class","mt-6 text-sm text-gray-300",4,"ngIf"],["class","mt-6 text-sm text-red-500",4,"ngIf"],["class","mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4",4,"ngIf"],[1,"mt-6","bg-[#10181f]","border","border-[#1d2a32]","rounded-xl","p-4","sm:p-5"],[1,"flex","items-center","justify-between"],[1,"text-base","sm:text-lg","font-semibold"],[1,"text-xs","sm:text-sm","text-green-400","hover:underline","cursor-pointer",3,"click"],["class","mt-4 text-sm text-gray-300",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"inline-flex","items-center","rounded-full","border","border-[#1d2a32]","bg-[#0a1117]","px-3","py-1","text-xs","sm:text-sm",3,"ngClass"],[1,"mt-6","text-sm","text-gray-300"],[1,"mt-6","text-sm","text-red-500"],[1,"mt-6","grid","grid-cols-1","sm:grid-cols-2","gap-4"],[1,"relative","rounded-xl","bg-[#10181f]","border","border-[#1d2a32]","shadow-md","p-4","sm:p-5"],[1,"flex","items-start","justify-between","gap-3"],[1,"min-w-0"],[1,"text-sm","sm:text-base","font-semibold"],["class","mt-0.5 text-xs text-gray-400 truncate",4,"ngIf"],["class","text-xs sm:text-sm font-medium",3,"ngClass",4,"ngIf"],[4,"ngIf","ngIfElse"],[1,"mt-0.5","text-xs","text-gray-400","truncate"],[1,"text-xs","sm:text-sm","font-medium",3,"ngClass"],[1,"mt-4","space-y-2","text-xs","sm:text-sm"],[1,"flex","justify-between","gap-3"],[1,"text-gray-300"],[3,"ngClass"],[1,"text-white"],["class","text-yellow-400",4,"ngIf"],[1,"mt-4","flex","flex-wrap","gap-2"],["routerLink","/pricing","class",`h-9 px-3 rounded text-xs sm:text-sm font-medium cursor-pointer flex items-center justify-center
                        bg-[#1d2a32] hover:bg-[#24303c] text-white`,4,"ngIf"],[1,"text-yellow-400"],["routerLink","/pricing",1,"h-9","px-3","rounded","text-xs","sm:text-sm","font-medium","cursor-pointer","flex","items-center","justify-center","bg-[#1d2a32]","hover:bg-[#24303c]","text-white"],[1,"mt-4","rounded-lg","border","border-dashed","border-[#1d2a32]","p-4","text-center","text-gray-300"],[1,"mt-4"],["routerLink","/pricing",1,"h-9","px-3","rounded","text-xs","sm:text-sm","font-medium","cursor-pointer","inline-flex","items-center","justify-center","bg-green-600","hover:bg-green-700","text-white"],[1,"mt-4","text-sm","text-gray-300"],[1,"space-y-3"],["class",`flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 text-xs sm:text-sm
                     text-[#c9d4df] bg-[#0f1720] border border-[#1d2a32] p-3 rounded-lg`,4,"ngFor","ngForOf"],[1,"flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-2","text-xs","sm:text-sm","text-[#c9d4df]","bg-[#0f1720]","border","border-[#1d2a32]","p-3","rounded-lg"],[1,"font-medium"],[1,"text-gray-400"]],template:function(e,r){e&1&&(o(0,"div",4)(1,"div",5)(2,"h1",6),l(3,"Subscription"),i()(),o(4,"div",7)(5,"div",8)(6,"div",9)(7,"h2",10),l(8,"Your Subscriptions"),i(),o(9,"div",11)(10,"span",12),l(11," Active: "),o(12,"strong",13),l(13),i()(),m(14,K,4,6,"span",14),i()(),m(15,V,2,0,"div",15)(16,Y,2,1,"div",16)(17,oe,21,12,"div",17),o(18,"div",18)(19,"div",19)(20,"h3",20),l(21,"Purchase History"),i(),o(22,"button",21),A("click",function(){return r.toggleHistory()}),l(23),i()(),m(24,se,2,0,"div",22)(25,pe,3,1,"div",23),i()()()()),e&2&&(s(13),c(" ",(r.primaryUi!=null&&r.primaryUi.active?1:0)+(r.advancedUi!=null&&r.advancedUi.active?1:0)," "),s(),d("ngIf",r.nextExpiryDays!==null),s(),d("ngIf",r.loading),s(),d("ngIf",!r.loading&&r.error),s(),d("ngIf",!r.loading&&!r.error),s(6),c(" ",r.showHistory?"Hide":"Show"," "),s(),d("ngIf",r.history.length===0),s(),d("ngIf",r.showHistory&&r.history.length>0))},dependencies:[F,T,M,P,H,j,N],encapsulation:2})};export{R as SubscriptionComponent};
