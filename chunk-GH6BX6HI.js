import{b as Z}from"./chunk-6ZL64XGU.js";import{b as k,d as D,e as L,f as O,g as q,h as j,k as U,l as H,m as z,o as G}from"./chunk-PFQNSONL.js";import{a as I}from"./chunk-B2LUGKIE.js";import{C as w,D as f,Ha as V,Ja as T,N as s,Na as F,P as g,Q as M,Qa as A,U as u,Y as p,Ya as R,Za as W,aa as i,ba as o,ca as C,cb as B,fa as b,ga as y,ha as c,la as S,ma as d,oa as _,qa as x,ra as h,sa as P,wa as E}from"./chunk-YD7KOX65.js";var J=(e,r)=>({"border-green-500":e,"border-red-500":r});function Q(e,r){if(e&1&&(i(0,"div",12)(1,"h3",8),d(2,"Email Address"),o(),C(3,"input",13),o()),e&2){let n=c();s(3),p("value",n.email)}}function X(e,r){e&1&&(i(0,"div",27),d(1," Current password is required. "),o())}function Y(e,r){e&1&&(i(0,"div",27),d(1," Password must be at least 6 characters. "),o())}function $(e,r){e&1&&(i(0,"div",27),d(1," Must contain at least one letter and one number. "),o())}function ee(e,r){e&1&&(i(0,"div",27),d(1," Passwords do not match. "),o())}function te(e,r){if(e&1&&(i(0,"div",28),d(1),o()),e&2){let n=c(3);s(),_(" ",n.passwordValidationError," ")}}function ne(e,r){e&1&&(i(0,"div",29),d(1," Password successfully changed. "),o())}function re(e,r){if(e&1&&(i(0,"div",30),d(1),o()),e&2){let n=c(3);s(),_(" ",n.passwordChangeError," ")}}function ie(e,r){if(e&1){let n=b();i(0,"form",17,0),y("ngSubmit",function(){w(n);let a=S(1),m=c(2);return f(m.submitPasswordChange(a))}),C(2,"input",18),i(3,"input",19,1),P("ngModelChange",function(a){w(n);let m=c(2);return h(m.currentPassword,a)||(m.currentPassword=a),f(a)}),o(),u(5,X,2,0,"div",20),i(6,"input",21),P("ngModelChange",function(a){w(n);let m=c(2);return h(m.newPassword,a)||(m.newPassword=a),f(a)}),o(),u(7,Y,2,0,"div",20)(8,$,2,0,"div",20),i(9,"input",22),P("ngModelChange",function(a){w(n);let m=c(2);return h(m.confirmNewPassword,a)||(m.confirmNewPassword=a),f(a)}),o(),u(10,ee,2,0,"div",20)(11,te,2,1,"div",23),i(12,"button",24),d(13," Save "),o(),u(14,ne,2,0,"div",25)(15,re,2,1,"div",26),o()}if(e&2){let n,l,a,m,v,N=S(4),t=c(2);s(3),x("ngModel",t.currentPassword),s(2),p("ngIf",N.invalid&&N.touched),s(),x("ngModel",t.newPassword),p("pattern",t.passwordRegex?t.passwordRegex.source:"")("ngClass",E(13,J,t.newPasswordValid(),!t.newPasswordValid()&&((n=t.newPassword==null?null:t.newPassword.length)!==null&&n!==void 0?n:0)>0)),s(),p("ngIf",((l=t.newPassword==null?null:t.newPassword.length)!==null&&l!==void 0?l:0)>0&&((l=t.newPassword==null?null:t.newPassword.length)!==null&&l!==void 0?l:0)<6),s(),p("ngIf",((a=t.newPassword==null?null:t.newPassword.length)!==null&&a!==void 0?a:0)>=6&&!t.newPasswordValid()),s(),x("ngModel",t.confirmNewPassword),p("ngClass",E(16,J,t.confirmNewPassword===t.newPassword&&((m=t.confirmNewPassword==null?null:t.confirmNewPassword.length)!==null&&m!==void 0?m:0)>0,t.confirmNewPassword!==t.newPassword&&((m=t.confirmNewPassword==null?null:t.confirmNewPassword.length)!==null&&m!==void 0?m:0)>0)),s(),p("ngIf",((v=t.confirmNewPassword==null?null:t.confirmNewPassword.length)!==null&&v!==void 0?v:0)>0&&t.confirmNewPassword!==t.newPassword),s(),p("ngIf",t.passwordValidationError),s(3),p("ngIf",t.passwordChangeSuccess),s(),p("ngIf",t.passwordChangeError)}}function oe(e,r){if(e&1){let n=b();i(0,"div",12)(1,"div",14)(2,"h3",8),d(3,"Change Password"),o(),i(4,"button",15),y("click",function(){w(n);let a=c();return f(a.showChangePassword=!a.showChangePassword)}),d(5),o()(),u(6,ie,16,19,"form",16),o()}if(e&2){let n=c();s(5),_(" ",n.showChangePassword?"Cancel":"Edit"," "),s(),p("ngIf",n.showChangePassword)}}function se(e,r){e&1&&(i(0,"p",31),d(1," Premium subscription: "),i(2,"strong"),d(3,"active"),o()())}function ae(e,r){e&1&&(i(0,"p",31),d(1," Advanced subscription: "),i(2,"strong"),d(3,"active"),o()())}function de(e,r){e&1&&(i(0,"p",32),d(1," No active subscription "),o())}var K=class e{constructor(r,n,l){this.http=r;this.router=n;this.auth=l}email="";hasPassword=!1;showChangePassword=!1;newPassword="";confirmNewPassword="";currentPassword="";passwordChangeSuccess=!1;passwordChangeError=null;passwordValidationError="";passwordRegex=/^(?=.*[A-Za-z])(?=.*\d).{6,}$/;subscriptionPrimary=null;subscriptionAdvanced=null;ngOnInit(){this.loadUserData()}loadUserData(){this.http.get(`${I.apiBaseUrl}/users/me`,{withCredentials:!0}).subscribe({next:r=>{this.email=r.email||"",this.hasPassword=r.hasPassword,this.subscriptionPrimary=r.subscriptionPrimary??null,this.subscriptionAdvanced=r.subscriptionAdvanced??null},error:r=>{console.error("Fehler beim Laden des Profils:",r)}})}navigateToSubscription(){this.router.navigate(["/pricing"])}submitPasswordChange(r){if(this.passwordValidationError="",this.passwordChangeSuccess=!1,this.passwordChangeError="",!this.passwordRegex.test(this.newPassword)){this.passwordValidationError="Password must contain at least one letter and one number.";return}if(this.newPassword!==this.confirmNewPassword){this.passwordValidationError="Passwords do not match.";return}this.http.post(`${I.apiBaseUrl}/auth/change-password`,{currentPassword:this.currentPassword,newPassword:this.newPassword,confirmNewPassword:this.confirmNewPassword},{withCredentials:!0}).subscribe({next:()=>{this.passwordChangeSuccess=!0,this.passwordChangeError="",this.passwordValidationError="",this.currentPassword="",this.newPassword="",this.confirmNewPassword="",r.resetForm()},error:n=>{console.error("Password change failed:",n),this.passwordChangeError=n?.error?.message||"Failed to change password."}})}newPasswordValid(){return this.passwordRegex.test(this.newPassword)}static \u0275fac=function(n){return new(n||e)(g(A),g(R),g(Z))};static \u0275cmp=M({type:e,selectors:[["app-profile"]],decls:15,vars:5,consts:[["changePwForm","ngForm"],["currentPw","ngModel"],[1,"min-h-screen","bg-[#141C22]","text-white","px-4","py-12"],[1,"text-center","mb-10"],[1,"text-3xl","font-bold"],[1,"max-w-3xl","mx-auto","space-y-8"],["class","bg-[#10181f] border border-[#1d2a32] rounded-xl p-4 sm:p-5 space-y-3",4,"ngIf"],[1,"bg-[#10181f]","border","border-[#1d2a32]","rounded-xl","p-4","sm:p-5","space-y-2"],[1,"text-lg","font-semibold"],["class","text-sm text-[#B6C2CF]",4,"ngIf"],["class","text-sm text-gray-400",4,"ngIf"],["routerLink","/subscription",1,"mt-3","inline-flex","bg-[#1d2a32]","hover:bg-[#24303c]","text-white","px-4","py-2","rounded-lg","text-sm","font-semibold","transition","cursor-pointer"],[1,"bg-[#10181f]","border","border-[#1d2a32]","rounded-xl","p-4","sm:p-5","space-y-3"],["disabled","",1,"w-full","bg-[#0f1720]","border","border-[#1d2a32]","p-3","rounded-lg","text-white","text-opacity-80","cursor-not-allowed",3,"value"],[1,"flex","justify-between","items-center"],[1,"text-sm","px-3","py-1","bg-[#0f1720]","border","border-[#1d2a32]","text-white","rounded","hover:bg-[#13202a]","transition","cursor-pointer",3,"click"],["class","space-y-3 mt-2",3,"ngSubmit",4,"ngIf"],[1,"space-y-3","mt-2",3,"ngSubmit"],["type","text","name","username","autocomplete","username",1,"hidden"],["name","currentPassword","required","","type","password","placeholder","Current password","autocomplete","current-password",1,"w-full","bg-[#0f1720]","border","border-[#1d2a32]","p-2","rounded","text-white","text-sm",3,"ngModelChange","ngModel"],["class","text-red-400 text-xs mt-1",4,"ngIf"],["name","newPassword","required","","minlength","6","type","password","placeholder","New password","autocomplete","new-password",1,"w-full","bg-[#0f1720]","border","p-2","rounded","text-white","text-sm","border-[#1d2a32]",3,"ngModelChange","ngModel","pattern","ngClass"],["name","confirmNewPassword","required","","type","password","placeholder","Confirm new password","autocomplete","new-password",1,"w-full","bg-[#0f1720]","border","p-2","rounded","text-white","text-sm","border-[#1d2a32]",3,"ngModelChange","ngModel","ngClass"],["class","text-red-400 text-xs",4,"ngIf"],["type","submit",1,"px-4","py-2","text-sm","bg-[#3DB34A]","hover:bg-[#34a042]","text-black","font-semibold","rounded","transition","cursor-pointer"],["class","text-green-400 text-xs pt-1",4,"ngIf"],["class","text-red-400 text-xs pt-1",4,"ngIf"],[1,"text-red-400","text-xs","mt-1"],[1,"text-red-400","text-xs"],[1,"text-green-400","text-xs","pt-1"],[1,"text-red-400","text-xs","pt-1"],[1,"text-sm","text-[#B6C2CF]"],[1,"text-sm","text-gray-400"]],template:function(n,l){n&1&&(i(0,"div",2)(1,"div",3)(2,"h1",4),d(3,"Profile"),o()(),i(4,"div",5),u(5,Q,4,1,"div",6)(6,oe,7,2,"div",6),i(7,"div",7)(8,"h3",8),d(9,"Active Subscription"),o(),u(10,se,4,0,"p",9)(11,ae,4,0,"p",9)(12,de,2,0,"p",10),i(13,"a",11),d(14," Manage Subscription "),o()()()()),n&2&&(s(5),p("ngIf",l.email),s(),p("ngIf",l.hasPassword),s(4),p("ngIf",l.subscriptionPrimary),s(),p("ngIf",l.subscriptionAdvanced),s(),p("ngIf",!l.subscriptionPrimary&&!l.subscriptionAdvanced))},dependencies:[F,V,T,G,j,k,D,L,U,H,z,q,O,B,W],styles:["@keyframes _ngcontent-%COMP%_fadeInFast{0%{opacity:0}to{opacity:1}}.animate-fade-in-fast[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeInFast .3s ease-in}"]})};export{K as ProfileComponent};
