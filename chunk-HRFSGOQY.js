import{a as W,d as Y,g as G,o as q}from"./chunk-PFQNSONL.js";import{a as y}from"./chunk-B2LUGKIE.js";import{Aa as x,Ba as j,C as I,D as E,E as b,F as k,Ia as O,Ja as L,Ma as V,N as d,Na as H,P as C,Q as S,Qa as N,U as s,X as w,Y as l,Ya as $,Za as U,aa as i,ba as n,ca as h,cb as z,da as T,e as _,ea as B,fa as F,ga as A,ha as m,k as g,la as D,ma as o,na as v,oa as c,qa as M,ra as R,sa as P,za as f}from"./chunk-YD7KOX65.js";function K(t,r){t&1&&(i(0,"div",21),o(1,"Your cart is empty."),n())}function Q(t,r){if(t&1&&(i(0,"div",30),o(1),n()),t&2){let e=m().$implicit;d(),c(" Save ",e.discountPercent,"% ")}}function X(t,r){if(t&1&&(T(0),i(1,"div",31),o(2),f(3,"number"),n(),i(4,"div",32),o(5),f(6,"number"),n(),B()),t&2){let e=m().$implicit;d(2),c("",x(3,2,e.discountedCostInEuro,"1.0-2")," \u20AC"),d(3),c("",x(6,5,e.costInEuro,"1.0-2")," \u20AC")}}function Z(t,r){if(t&1&&(i(0,"div",31),o(1),f(2,"number"),n()),t&2){let e=m().$implicit;d(),c("",x(2,1,e.costInEuro,"1.0-2")," \u20AC")}}function ee(t,r){if(t&1&&(i(0,"div",22)(1,"div",23)(2,"div",24),o(3),i(4,"span",25),o(5),n()(),i(6,"div",26),o(7),n(),s(8,Q,2,1,"div",27),n(),i(9,"div",28),s(10,X,7,8,"ng-container",29)(11,Z,3,4,"ng-template",null,0,j),n()()),t&2){let e=r.$implicit,a=D(12);d(3),c(" ",e.label," "),d(2),c("(",e.feature,")"),d(2),c("",e.durationInDays," days"),d(),l("ngIf",e.discountPercent),d(2),l("ngIf",e.discountedCostInEuro!==void 0)("ngIfElse",a)}}function te(t,r){t&1&&(b(),i(0,"svg",35),h(1,"circle",36)(2,"path",37),n())}function ie(t,r){if(t&1){let e=F();i(0,"button",33),A("click",function(){let p=I(e).$implicit,u=m();return E(u.select(p.key))}),s(1,te,3,0,"svg",34),i(2,"span"),o(3),n()()}if(t&2){let e=r.$implicit,a=m();l("disabled",!!a.loadingCurrency||!a.tosAccepted||a.cart.length===0),d(),l("ngIf",a.loadingCurrency===e.key),d(2),v(e.label)}}function ne(t,r){if(t&1&&(i(0,"div",38),o(1),n()),t&2){let e=m();d(),v(e.error)}}function re(t,r){t&1&&(i(0,"div",39),o(1,"Creating order\u2026"),n())}function oe(t,r){t&1&&(i(0,"div",40)(1,"div",41),b(),i(2,"svg",42),h(3,"circle",43)(4,"path",44),n(),k(),i(5,"div",21),o(6,"Preparing secure payment\u2026"),n()()())}var J=class t{constructor(r,e){this.http=r;this.router=e}cart=history.state?.cart||[];tosAccepted=!1;loadingCurrency=null;phase="idle";orderId=null;error="";currencies=[{key:"btc",label:"Bitcoin (BTC)"},{key:"eth",label:"Ethereum (ETH)"},{key:"usdterc20",label:"USDT (ERC-20)"},{key:"usdttrc20",label:"USDT (TRC-20)"},{key:"ltc",label:"Litecoin (LTC)"},{key:"sol",label:"Solana (SOL)"}];priceOf(r){return typeof r.discountedCostInEuro=="number"?r.discountedCostInEuro:r.costInEuro}get total(){return this.cart.reduce((r,e)=>r+this.priceOf(e),0)}select(r){return _(this,null,function*(){if(!this.tosAccepted){this.error="Please accept the Terms of Service.";return}if(!this.cart.length){this.error="Your cart is empty.";return}if(!this.loadingCurrency){this.error="",this.loadingCurrency=r;try{if(!this.orderId){this.phase="creating-order";let a=yield g(this.http.post(`${y.apiBaseUrl}/orders`,{cart:this.cart.map(p=>({model:p.model,feature:p.feature}))},{withCredentials:!0}));this.orderId=a.orderId}this.phase="creating-payment";let e=yield g(this.http.post(`${y.apiBaseUrl}/payments/now/create`,{orderId:this.orderId,payCurrency:r},{withCredentials:!0}));this.router.navigate(["/checkout/pay",e.paymentId],{state:{pay:e,orderId:this.orderId}})}catch{this.error="Could not start the payment. Please try again.",this.phase="idle",this.loadingCurrency=null}}})}static \u0275fac=function(e){return new(e||t)(C(N),C($))};static \u0275cmp=S({type:t,selectors:[["app-checkout"]],decls:32,vars:12,consts:[["noDiscount",""],[1,"min-h-screen","bg-[#141C22]","text-white","px-4","py-12"],[1,"max-w-5xl","mx-auto"],[1,"text-3xl","font-bold","mb-3","text-center"],[1,"text-[#B6C2CF]","text-sm","text-center","mb-8"],[1,"bg-[#10181f]","border","border-[#1d2a32]","rounded-xl","p-5","mb-6","shadow"],[1,"text-lg","font-semibold","mb-3"],["class","text-sm text-[#B6C2CF]",4,"ngIf"],["class","flex justify-between items-start bg-[#0f1720] border border-[#1d2a32] rounded p-3 mb-2",4,"ngFor","ngForOf"],[1,"flex","justify-between","border-t","border-[#1d2a32]","pt-3","mt-3"],[1,"text-[#FFD700]","font-bold"],[1,"flex","items-center","gap-2","text-sm","mb-6"],["type","checkbox",1,"h-4","w-4","rounded","border-[#1d2a32]","bg-[#0f1720]","cursor-pointer",3,"ngModelChange","ngModel"],["routerLink","/terms-of-service",1,"text-[#3DB34A]","hover:underline","cursor-pointer"],["aria-live","polite",1,"bg-[#10181f]","border","border-[#1d2a32]","rounded-xl","p-5","shadow"],[1,"text-lg","font-semibold","mb-4"],[1,"grid","grid-cols-2","md:grid-cols-3","gap-3"],["class","px-4 py-3 rounded-lg bg-[#0f1720] border border-[#1d2a32] hover:border-[#3DB34A] cursor-pointer flex items-center justify-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed",3,"disabled","click",4,"ngFor","ngForOf"],["class","mt-4 p-3 rounded bg-[#2A1C1C] border border-red-500 text-red-300 text-sm",4,"ngIf"],["class","mt-4 text-sm text-[#B6C2CF]",4,"ngIf"],["class","fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50",4,"ngIf"],[1,"text-sm","text-[#B6C2CF]"],[1,"flex","justify-between","items-start","bg-[#0f1720]","border","border-[#1d2a32]","rounded","p-3","mb-2"],[1,"min-w-0"],[1,"font-semibold"],[1,"text-xs","text-gray-400","ml-2"],[1,"text-xs","text-[#B6C2CF]"],["class","text-[11px] text-green-400 mt-1",4,"ngIf"],[1,"text-right"],[4,"ngIf","ngIfElse"],[1,"text-[11px]","text-green-400","mt-1"],[1,"text-[#FFD700]","font-semibold"],[1,"line-through","text-[#8aa0ad]","text-xs"],[1,"px-4","py-3","rounded-lg","bg-[#0f1720]","border","border-[#1d2a32]","hover:border-[#3DB34A]","cursor-pointer","flex","items-center","justify-center","gap-2","disabled:opacity-60","disabled:cursor-not-allowed",3,"click","disabled"],["class","animate-spin h-4 w-4","viewBox","0 0 24 24","fill","none",4,"ngIf"],["viewBox","0 0 24 24","fill","none",1,"animate-spin","h-4","w-4"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","3",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8v3a5 5 0 00-5 5H4z",1,"opacity-75"],[1,"mt-4","p-3","rounded","bg-[#2A1C1C]","border","border-red-500","text-red-300","text-sm"],[1,"mt-4","text-sm","text-[#B6C2CF]"],[1,"fixed","inset-0","bg-black/60","backdrop-blur-sm","flex","items-center","justify-center","z-50"],[1,"bg-[#0f1720]","border","border-[#1d2a32]","rounded-xl","p-6","flex","items-center","gap-3"],["viewBox","0 0 24 24","fill","none",1,"animate-spin","h-5","w-5"],["cx","12","cy","12","r","10","stroke","white","stroke-width","3",1,"opacity-25"],["fill","white","d","M4 12a8 8 0 018-8v3a5 5 0 00-5 5H4z",1,"opacity-75"]],template:function(e,a){e&1&&(i(0,"div",1)(1,"div",2)(2,"h1",3),o(3,"Checkout"),n(),i(4,"p",4),o(5,"Review your selection and choose a payment method."),n(),i(6,"div",5)(7,"h2",6),o(8,"Your Order"),n(),s(9,K,2,0,"div",7)(10,ee,13,6,"div",8),i(11,"div",9)(12,"span"),o(13,"Total"),n(),i(14,"span",10),o(15),f(16,"number"),n()()(),i(17,"label",11)(18,"input",12),P("ngModelChange",function(u){return R(a.tosAccepted,u)||(a.tosAccepted=u),u}),n(),i(19,"span"),o(20,"I accept the "),i(21,"a",13),o(22,"Terms of Service"),n(),o(23,"."),n()(),i(24,"div",14)(25,"h2",15),o(26,"Choose a crypto method"),n(),i(27,"div",16),s(28,ie,4,3,"button",17),n(),s(29,ne,2,1,"div",18)(30,re,2,0,"div",19),n()(),s(31,oe,7,0,"div",20),n()),e&2&&(w("aria-busy",!!a.loadingCurrency),d(9),l("ngIf",a.cart.length===0),d(),l("ngForOf",a.cart),d(5),c("",x(16,9,a.total,"1.0-2")," \u20AC"),d(3),M("ngModel",a.tosAccepted),d(10),l("ngForOf",a.currencies),d(),l("ngIf",a.error),d(),l("ngIf",a.phase==="creating-order"),d(),l("ngIf",a.phase==="creating-payment"))},dependencies:[H,O,L,V,q,W,Y,G,z,U],encapsulation:2})};export{J as CheckoutComponent};
